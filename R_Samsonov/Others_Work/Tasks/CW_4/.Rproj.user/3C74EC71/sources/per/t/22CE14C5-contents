library(readxl)
library(dplyr)
#library(readxl)
#library(xlsx)

setwd("C:/Users/Lera/Desktop/4 level/MKK/Dates 4")
tab <- read_xlsx("IncomeConsumption.xlsx", 1)
str(tab)

tab <- tab %>% mutate(ratio=tab$ƒоход/tab$–асходы) #добавление нового столбца
col1 <- rgb(1, 0, 0, 0.5)
plot(tab$ƒоход, 
     tab$–асходы,
     col=col1,
     xlab="ƒоход, тыс. руб.",
     ylab="ѕотребительские расходы, тыс. руб.",
     main="—оотношение среднемес¤чных расходов и доходов\n на душу населени¤ по регионам –оссии",
     pch = 19, #номер символа
     cex = tab$ratio) # размер кругов
grid()

legend(x="topleft",
       y = c('1', '2', '3'),
       pch = c(19, 19, 19),
       pt.cex = c(1, 2, 3),
       col = col1,
       horiz = TRUE)


# √истограммы распределени¤ доходов и расходов населени¤ по субъектам ‘едерации
hist(tab$ƒоход, 
     breaks = seq(10000, 70000, 2000),  
     col = "deeppink",
     main = '–аспределение доходов населени¤\n по субъектам ‘едерации',
     xlab = 'ƒоходы, руб',
     ylab = ' оличество субъектов –‘')       

hist(tab$–асходы, 
     breaks = seq(4000, 42000, 2000),  
     col = "cyan",
     main = '–аспределение расходов наседени¤\n по субъектам ‘едерации',
     xlab = '–асход, руб',
     ylab = ' оличество субъектов –‘')


# —толбчатые диаграммы по доходам и расходам в федеральных округах –‘
stolbfo <- grep('федеральный округ', tab$–егион)
fok <- tab[stolbfo, ] # таблица только с ‘едеральными округами

## ƒиаграмма доходов
sortirovka <- order(fok$ƒоход, decreasing = TRUE)
fok_sortirovka <- fok[sortirovka, ]# сортировка таблицы в пор¤дке убывани¤ доходов

names <- c('÷ентральный', '”ральский', 'ƒалневосточный', '—еверо-«ападный','ѕривожский', 'ёжный', '—ибирский', '—еверо- авказский')
par(mar = c(5, 8, 6, 2)) # резервируем пол¤
barplot(fok_sortirovka$ƒоход, # построение столбчатой диаграммы
        col = "darkorange",
        main = '–аспределение доходов населелени¤\n в федеральных округах –‘',
        xlab = 'ƒоходы, руб',
        names.arg = names, # задание название столбцов
        xlim = c(0, 35000), # длина оси ’
        ylim = c(0, 8), # длина оси ”
        horiz = TRUE, # переворот графика горизонтально
        las = 1, # подпись оси всегда горизонтально
        cex.names = 0.7) # устанавливаем размер шрифта

## ƒиаграмма расходов
sortirovka2 <- order(fok$–асходы, decreasing = TRUE)
fok_sortirovka2 <- fok[sortirovka2, ]# сортировка таблицы в пор¤дке убывани¤ расходов 

names2 <- c('÷ентральный', '”ральский', 'ƒалневосточный', '—еверо-«ападный','ёжный', 'ѕривожский', '—ибирский', '—еверо- авказский')
par(mar = c(5, 8, 6, 2)) # резервируем пол¤
barplot(fok_sortirovka2$–асходы, # построение столбчатой диаграммы
        col = "firebrick",
        main = '–аспределение расходов населелени¤\n в федеральных округах –‘',
        xlab = '–асходы, руб',
        names.arg = names2, # задание название столбцов
        xlim = c(0, 25000), # длина оси ’
        ylim = c(0, 8), # длина оси ”
        horiz = TRUE, # переворот графика горизонтально
        las = 1, # подпись оси всегда горизонтально
        cex.names = 0.7) # устанавливаем размер шрифта
